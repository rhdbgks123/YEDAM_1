<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.mapper.LastItemMapper">

<insert id = "lastItemViewAdd" parameterType="map" >
insert into tb_last_item
 (user_id,
  item_code,
  created_by,
  updated_by)
values( #{userId},
        #{itemCode},
        'myk',
        'myk')
</insert>

<select id = "lastItemViewList" parameterType="String" resultType = "last">
select rownum rn,
       a.*             
from ( select a.user_id,
              a.item_code,       
              MIN(b.item_image) AS item_image
       from tb_last_item a
       join tb_item_image b
       on a.item_code = b.item_code
       where a.create_date between trunc(sysdate)-1 and trunc(sysdate)+1
        <if test="userId != null">
        AND user_id = #{userId}
        </if>
        <if test="userId == guest">
        AND user_id = 'guest'
        </if> 
        group by a.user_id, a.item_code                
        order by MAX(a.create_date) desc) a
<![CDATA[
where rownum<=3
]]>  
</select>

</mapper>